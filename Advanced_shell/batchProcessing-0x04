#!/bin/bash
POKEMONS=(Bulbasaur Ivysaur Venusaur Charmander Charmeleon)
DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$DIR"

for P in "${POKEMONS[@]}"; do
(
    ATTEMPTS=0
    SUCCESS=0
    while [ $ATTEMPTS -lt 3 ]; do
        curl -s "https://pokeapi.co/api/v2/pokemon/${P,,}" -o "$DIR/$P.json"
        if [ $? -eq 0 ] && [ -s "$DIR/$P.json" ]; then
            echo "Saved data to $DIR/$P.json ✅"
            SUCCESS=1
            break
        else
            echo "Attempt $((ATTEMPTS+1)) failed for $P" >> "$ERROR_LOG"
            ATTEMPTS=$((ATTEMPTS+1))
            sleep 1
        fi
    done

    if [ $SUCCESS -eq 0 ]; then
        echo "Failed to fetch $P after 3 attempts." >> "$ERROR_LOG"
    fi
) &
# Store PID of background process
PIDS[${P}]=$!
done

# Show background jobs
jobs

# Example: terminate a process if needed (demonstration)
# Uncomment the next line to kill a specific Pokémon fetch
# kill ${PIDS[Bulbasaur]}

# Wait for all background processes to finish
wait

echo "All background processes completed."
