#!/bin/bash
DIR="pokemon_data"
CSV="pokemon_report.csv"

# CSV header
echo "Name,Height (m),Weight (kg)" > "$CSV"

HEIGHT_SUM=0
WEIGHT_SUM=0
COUNT=0

for FILE in "$DIR"/*.json; do
    NAME=$(jq -r '.name' "$FILE" | sed 's/\b\(.\)/\u\1/')
    HEIGHT=$(jq -r '.height' "$FILE")
    WEIGHT=$(jq -r '.weight' "$FILE")
    
    FORMATTED_HEIGHT=$(echo "$HEIGHT" | awk '{printf "%.1f", $1/10}')
    FORMATTED_WEIGHT=$(echo "$WEIGHT" | awk '{printf "%.1f", $1/10}')

    echo "$NAME,$FORMATTED_HEIGHT,$FORMATTED_WEIGHT" >> "$CSV"

    HEIGHT_SUM=$(awk "BEGIN {print $HEIGHT_SUM+$FORMATTED_HEIGHT}")
    WEIGHT_SUM=$(awk "BEGIN {print $WEIGHT_SUM+$FORMATTED_WEIGHT}")
    COUNT=$((COUNT + 1))
done

AVG_HEIGHT=$(awk "BEGIN {print $HEIGHT_SUM/$COUNT}")
AVG_WEIGHT=$(awk "BEGIN {print $WEIGHT_SUM/$COUNT}")

echo "CSV Report generated at: $CSV"
echo "Average Height: $AVG_HEIGHT m"
echo "Average Weight: $AVG_WEIGHT kg"
